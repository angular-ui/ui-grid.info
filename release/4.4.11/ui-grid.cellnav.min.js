/*!
 * ui-grid - v4.4.11 - 2018-05-16
 * Copyright (c) 2018 ; License: MIT 
 */


!function(){"use strict";var e=angular.module("ui.grid.cellNav",["ui.grid"]);e.constant("uiGridCellNavConstants",{FEATURE_NAME:"gridCellNav",CELL_NAV_EVENT:"cellNav",direction:{LEFT:0,RIGHT:1,UP:2,DOWN:3,PG_UP:4,PG_DOWN:5},EVENT_TYPE:{KEYDOWN:0,CLICK:1,CLEAR:2}}),e.factory("uiGridCellNavFactory",["gridUtil","uiGridConstants","uiGridCellNavConstants","GridRowColumn","$q",function(e,i,o,a,l){var n=function(e,i,l,o){this.rows=e.visibleRowCache,this.columns=i.visibleColumnCache,this.leftColumns=l?l.visibleColumnCache:[],this.rightColumns=o?o.visibleColumnCache:[],this.bodyContainer=e};return n.prototype.getFocusableCols=function(){return this.leftColumns.concat(this.columns,this.rightColumns).filter(function(e){return e.colDef.allowCellFocus})},n.prototype.getFocusableRows=function(){return this.rows.filter(function(e){return!1!==e.allowCellFocus})},n.prototype.getNextRowCol=function(e,i,l){switch(e){case o.direction.LEFT:return this.getRowColLeft(i,l);case o.direction.RIGHT:return this.getRowColRight(i,l);case o.direction.UP:return this.getRowColUp(i,l);case o.direction.DOWN:return this.getRowColDown(i,l);case o.direction.PG_UP:return this.getRowColPageUp(i,l);case o.direction.PG_DOWN:return this.getRowColPageDown(i,l)}},n.prototype.initializeSelection=function(){var e=this.getFocusableCols(),i=this.getFocusableRows();if(0===e.length||0===i.length)return null;return new a(i[0],e[0])},n.prototype.getRowColLeft=function(e,i){var l=this.getFocusableCols(),o=this.getFocusableRows(),n=l.indexOf(i),t=o.indexOf(e);-1===n&&(n=1);var r=0===n?l.length-1:n-1;return new a(n<=r?0===t?e:o[t-1]:e,l[r])},n.prototype.getRowColRight=function(e,i){var l=this.getFocusableCols(),o=this.getFocusableRows(),n=l.indexOf(i),t=o.indexOf(e);-1===n&&(n=0);var r=n===l.length-1?0:n+1;return r<=n?t===o.length-1?new a(e,l[r]):new a(o[t+1],l[r]):new a(e,l[r])},n.prototype.getRowColDown=function(e,i){var l=this.getFocusableCols(),o=this.getFocusableRows(),n=l.indexOf(i),t=o.indexOf(e);return-1===n&&(n=0),t===o.length-1?new a(e,l[n]):new a(o[t+1],l[n])},n.prototype.getRowColPageDown=function(e,i){var l=this.getFocusableCols(),o=this.getFocusableRows(),n=l.indexOf(i),t=o.indexOf(e);-1===n&&(n=0);var r=this.bodyContainer.minRowsToRender();return t>=o.length-r?new a(o[o.length-1],l[n]):new a(o[t+r],l[n])},n.prototype.getRowColUp=function(e,i){var l=this.getFocusableCols(),o=this.getFocusableRows(),n=l.indexOf(i),t=o.indexOf(e);return-1===n&&(n=0),new a(0===t?e:o[t-1],l[n])},n.prototype.getRowColPageUp=function(e,i){var l=this.getFocusableCols(),o=this.getFocusableRows(),n=l.indexOf(i),t=o.indexOf(e);-1===n&&(n=0);var r=this.bodyContainer.minRowsToRender();return new a(t-r<0?o[0]:o[t-r],l[n])},n}]),e.service("uiGridCellNavService",["gridUtil","uiGridConstants","uiGridCellNavConstants","$q","uiGridCellNavFactory","GridRowColumn","ScrollEvent",function(e,i,l,o,n,t,r){var a={initializeGrid:function(o){o.registerColumnBuilder(a.cellNavColumnBuilder),o.cellNav={},o.cellNav.lastRowCol=null,o.cellNav.focusedCells=[],a.defaultGridOptions(o.options);var e={events:{cellNav:{navigate:function(e,i){},viewPortKeyDown:function(e,i){},viewPortKeyPress:function(e,i){}}},methods:{cellNav:{scrollToFocus:function(e,i){return a.scrollToFocus(o,e,i)},getFocusedCell:function(){return o.cellNav.lastRowCol},getCurrentSelection:function(){return o.cellNav.focusedCells},rowColSelectIndex:function(e){for(var i=-1,l=0;l<o.cellNav.focusedCells.length;l++)if(o.cellNav.focusedCells[l].col.uid===e.col.uid&&o.cellNav.focusedCells[l].row.uid===e.row.uid){i=l;break}return i}}}};o.api.registerEventsFromObject(e.events),o.api.registerMethodsFromObject(e.methods)},defaultGridOptions:function(e){e.modifierKeysToMultiSelectCells=!0===e.modifierKeysToMultiSelectCells,e.keyDownOverrides=e.keyDownOverrides||[]},decorateRenderContainers:function(e){var i=e.hasRightContainer()?e.renderContainers.right:null,l=e.hasLeftContainer()?e.renderContainers.left:null;null!==l&&(e.renderContainers.left.cellNav=new n(e.renderContainers.body,l,i,e.renderContainers.body)),null!==i&&(e.renderContainers.right.cellNav=new n(e.renderContainers.body,i,e.renderContainers.body,l)),e.renderContainers.body.cellNav=new n(e.renderContainers.body,e.renderContainers.body,l,i)},getDirection:function(e){return e.keyCode===i.keymap.LEFT||e.keyCode===i.keymap.TAB&&e.shiftKey?l.direction.LEFT:e.keyCode===i.keymap.RIGHT||e.keyCode===i.keymap.TAB?l.direction.RIGHT:e.keyCode===i.keymap.UP||e.keyCode===i.keymap.ENTER&&e.shiftKey?l.direction.UP:e.keyCode===i.keymap.PG_UP?l.direction.PG_UP:e.keyCode===i.keymap.DOWN||e.keyCode===i.keymap.ENTER&&!e.ctrlKey&&!e.altKey?l.direction.DOWN:e.keyCode===i.keymap.PG_DOWN?l.direction.PG_DOWN:null},cellNavColumnBuilder:function(e,i,l){return e.allowCellFocus=void 0===e.allowCellFocus||e.allowCellFocus,o.all([])},scrollToFocus:function(i,e,l){var o=null,n=null;return null!=e&&(o=i.getRow(e)),null!=l&&(n=i.getColumn(l.name?l.name:l.field)),i.api.core.scrollToIfNecessary(o,n).then(function(){var e={row:o,col:n};null!==o&&null!==n&&i.cellNav.broadcastCellNav(e,null,null)})},getLeftWidth:function(e,i){var l=0;if(!i)return l;var o=e.renderContainers.body.visibleColumnCache.indexOf(i);e.renderContainers.body.visibleColumnCache.forEach(function(e,i){i<o&&(l+=e.drawnWidth)});var n=0===o?0:(o+1)/e.renderContainers.body.visibleColumnCache.length;return l+=i.drawnWidth*n}};return a}]),e.directive("uiGridCellnav",["gridUtil","uiGridCellNavService","uiGridCellNavConstants","uiGridConstants","GridRowColumn","$timeout","$compile","i18nService",function(e,s,d,u,v,i,r,f){return{replace:!0,priority:-150,require:"^uiGrid",scope:!1,controller:function(){},compile:function(){return{pre:function(e,i,l,a){var o=e,c=a.grid;s.initializeGrid(c),a.cellNav={},a.cellNav.makeRowCol=function(e){return e instanceof v||(e=new v(e.row,e.col)),e},a.cellNav.getActiveCell=function(){var e=i[0].getElementsByClassName("ui-grid-cell-focus");if(0<e.length)return e[0]},a.cellNav.broadcastCellNav=c.cellNav.broadcastCellNav=function(e,i,l){i=!(void 0===i||!i),e=a.cellNav.makeRowCol(e),a.cellNav.broadcastFocus(e,i,l),o.$broadcast(d.CELL_NAV_EVENT,e,i,l)},a.cellNav.clearFocus=c.cellNav.clearFocus=function(){c.cellNav.focusedCells=[],o.$broadcast(d.CELL_NAV_EVENT)},a.cellNav.broadcastFocus=function(e,i,l){i=!(void 0===i||!i);var o=(e=a.cellNav.makeRowCol(e)).row,n=e.col,t=a.grid.api.cellNav.rowColSelectIndex(e);if(null===c.cellNav.lastRowCol||-1===t||c.cellNav.lastRowCol.col===n&&c.cellNav.lastRowCol.row===o){var r=new v(o,n);(null===c.cellNav.lastRowCol||c.cellNav.lastRowCol.row!==r.row||c.cellNav.lastRowCol.col!==r.col||c.options.enableCellEditOnFocus)&&(c.api.cellNav.raise.navigate(r,c.cellNav.lastRowCol,l),c.cellNav.lastRowCol=r),a.grid.options.modifierKeysToMultiSelectCells&&i?c.cellNav.focusedCells.push(e):c.cellNav.focusedCells=[e]}else c.options.modifierKeysToMultiSelectCells&&i&&0<=t&&c.cellNav.focusedCells.splice(t,1)},a.cellNav.handleKeyDown=function(e){var i=s.getDirection(e);if(null===i)return null;var l="body";e.uiGridTargetRenderContainerId&&(l=e.uiGridTargetRenderContainerId);var o=a.grid.api.cellNav.getFocusedCell();if(o){var n=a.grid.renderContainers[l].cellNav.getNextRowCol(i,o.row,o.col),t=a.grid.renderContainers[l].cellNav.getFocusableCols(),r=a.grid.api.cellNav.rowColSelectIndex(n);return i===d.direction.LEFT&&n.col===t[t.length-1]&&n.row===o.row&&e.keyCode===u.keymap.TAB&&e.shiftKey?(c.cellNav.focusedCells.splice(r,1),a.cellNav.clearFocus(),!0):i!==d.direction.RIGHT||n.col!==t[0]||n.row!==o.row||e.keyCode!==u.keymap.TAB||e.shiftKey?(c.scrollToIfNecessary(n.row,n.col).then(function(){a.cellNav.broadcastCellNav(n,null,e)}),e.stopPropagation(),e.preventDefault(),!1):(c.cellNav.focusedCells.splice(r,1),a.cellNav.clearFocus(),!0)}}},post:function(e,i,l,o){var n,v,C=o.grid,t=!0;try{angular.module("ngAria")}catch(e){t=!1}t&&(n='<div id="'+C.id+'-aria-speakable" class="ui-grid-a11y-ariascreenreader-speakable ui-grid-offscreen" aria-live="assertive" role="alert" aria-atomic="true" aria-hidden="false" aria-relevant="additions" >&nbsp;</div>',v=r(n)(e),i.prepend(v),e.$on(d.CELL_NAV_EVENT,function(e,i,l,o){if(!o||"focus"!==o.type){for(var n,t,r=[],a=C.api.cellNav.getCurrentSelection(),c=0;c<a.length;c++){var s=("selectionRowHeaderCol"===(t=a[c]).col.field?t.row.isSelected?f.getSafeText("search.aria.selected"):f.getSafeText("search.aria.notSelected"):C.getCellDisplayValue(t.row,t.col))+(n=a[c].col,", "+f.getSafeText("headerCell.aria.column")+" "+n.displayName);r.push(s)}var d,u=r.toString();(d=u)!==v.text().trim()&&(v[0].style.clip="rect(0px,0px,0px,0px)",v[0].innerHTML="",v[0].style.visibility="hidden",v[0].style.visibility="visible",""!==d&&(v[0].style.clip="auto",v[0].appendChild(document.createTextNode(d+" ")),v[0].style.visibility="hidden",v[0].style.visibility="visible"))}}))}}}}}]),e.directive("uiGridRenderContainer",["$timeout","$document","gridUtil","uiGridConstants","uiGridCellNavService","$compile","uiGridCellNavConstants",function(u,e,v,i,C,f,g){return{replace:!0,priority:-99999,require:["^uiGrid","uiGridRenderContainer","?^uiGridCellnav"],scope:!1,compile:function(){return{post:function(e,i,l,o){var n=o[0],t=o[1],r=o[2];if(n.grid.api.cellNav){var a=t.containerId,c=n.grid;if(C.decorateRenderContainers(c),"body"===a){n.grid.options.modifierKeysToMultiSelectCells?i.attr("aria-multiselectable",!0):i.attr("aria-multiselectable",!1);var s=f('<div class="ui-grid-focuser" role="region" aria-live="assertive" aria-atomic="false" tabindex="0" aria-controls="'+c.id+"-aria-speakable "+c.id+'-grid-container" aria-owns="'+c.id+'-grid-container"></div>')(e);i.append(s),s.on("focus",function(e){e.uiGridTargetRenderContainerId=a;var i=n.grid.api.cellNav.getFocusedCell();null===i&&(i=n.grid.renderContainers[a].cellNav.getNextRowCol(g.direction.DOWN,null,null)).row&&i.col&&n.cellNav.broadcastCellNav(i)}),r.setAriaActivedescendant=function(e){i.attr("aria-activedescendant",e)},r.removeAriaActivedescendant=function(e){i.attr("aria-activedescendant")===e&&i.attr("aria-activedescendant","")},n.focus=function(){v.focus.byElement(s[0])};var d=null;s.on("keydown",function(l){l.uiGridTargetRenderContainerId=a;var e=n.grid.api.cellNav.getFocusedCell();null===(n.grid.options.keyDownOverrides.some(function(i){return Object.keys(i).every(function(e){return i[e]===l[e]})})?null:n.cellNav.handleKeyDown(l))&&(n.grid.api.cellNav.raise.viewPortKeyDown(l,e,n.cellNav.handleKeyDown),d=e)}),s.on("keypress",function(e){d&&(u(function(){n.grid.api.cellNav.raise.viewPortKeyPress(e,d)},4),d=null)}),e.$on("$destroy",function(){s.off()})}}}}}}}]),e.directive("uiGridViewport",["$timeout","$document","gridUtil","uiGridConstants","uiGridCellNavService","uiGridCellNavConstants","$log","$compile",function(e,i,l,o,n,t,r,a){return{replace:!0,priority:-99999,require:["^uiGrid","^uiGridRenderContainer","?^uiGridCellnav"],scope:!1,compile:function(){return{pre:function(e,i,l,o){},post:function(e,i,l,o){var n=o[0],t=o[1];if(n.grid.api.cellNav&&"body"===t.containerId){var r=n.grid;r.api.core.on.scrollBegin(e,function(e){var i=n.grid.api.cellNav.getFocusedCell();null!==i&&t.colContainer.containsColumn(i.col)&&n.cellNav.clearFocus()}),r.api.core.on.scrollEnd(e,function(e){var i=n.grid.api.cellNav.getFocusedCell();null!==i&&t.colContainer.containsColumn(i.col)&&n.cellNav.broadcastCellNav(i)}),r.api.cellNav.on.navigate(e,function(){n.focus()})}}}}}}]),e.directive("uiGridCell",["$timeout","$document","uiGridCellNavService","gridUtil","uiGridCellNavConstants","uiGridConstants","GridRowColumn",function(e,i,l,o,u,v,C){return{priority:-150,restrict:"A",require:["^uiGrid","?^uiGridCellnav"],scope:!1,link:function(l,i,e,o){var n=o[0],t=o[1];if(n.grid.api.cellNav&&l.col.colDef.allowCellFocus){var r=n.grid;l.focused=!1,i.attr("tabindex",-1),i.find("div").on("click",function(e){n.cellNav.broadcastCellNav(new C(l.row,l.col),e.ctrlKey||e.metaKey,e),e.stopPropagation(),l.$apply()}),i.on("mousedown",c),n.grid.api.edit&&(n.grid.api.edit.on.beginCellEdit(l,function(){i.off("mousedown",c)}),n.grid.api.edit.on.afterCellEdit(l,function(){i.on("mousedown",c)}),n.grid.api.edit.on.cancelCellEdit(l,function(){i.on("mousedown",c)})),s(),i.on("focus",function(e){n.cellNav.broadcastCellNav(new C(l.row,l.col),!1,e),e.stopPropagation(),l.$apply()}),l.$on(u.CELL_NAV_EVENT,s);var a=n.grid.registerDataChangeCallback(function(e){d(),l.$applyAsync(s)},[v.dataChange.ROW]);l.$on("$destroy",function(){a(),i.find("div").off(),i.off()})}function c(e){e.preventDefault()}function s(){r.cellNav.focusedCells.some(function(e,i){return e.row===l.row&&e.col===l.col})?function(){if(!l.focused){var e=i.find("div");e.addClass("ui-grid-cell-focus"),i.attr("aria-selected",!0),t.setAriaActivedescendant(i.attr("id")),l.focused=!0}}():d()}function d(){l.focused&&(i.find("div").removeClass("ui-grid-cell-focus"),i.attr("aria-selected",!1),t.removeAriaActivedescendant(i.attr("id")),l.focused=!1)}}}}])}();